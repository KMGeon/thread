
# Wait-Notify ë©”ì»¤ë‹ˆì¦˜ ì™„ì „ ì •ë¦¬

## ê°œìš”
- synchronized ì˜ ì„ê³„ì˜ì—­ ì•ˆì—ì„œ ë°œìƒí•˜ëŠ” ë¬´í•œ ëŒ€ê¸° ë¬¸ì œë¥¼ wait()ì™€ notify() ë©”ì„œë“œë¥¼ í†µí•´ í•´ê²°í•˜ëŠ” ìë°”ì˜ í•µì‹¬ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜

> Wait-notify ë©”ì»¤ë‹ˆì¦˜ì€ synchronizedì˜ ë½ ê²½í•© ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í•µì‹¬ ë„êµ¬ì…ë‹ˆë‹¤. ë½ì„ í•´ì œí•˜ê³  ì¡°ê±´ë¶€ ëŒ€ê¸°í•¨ìœ¼ë¡œì¨ ìŠ¤ë ˆë“œë“¤ì´ í˜‘ë ¥ì ìœ¼ë¡œ ì‘ì—…í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.


## synchronizedì˜ ë¬´í•œ ëŒ€ê¸° ë¬¸ì œ

### ë¬¸ì œ ìƒí™©
![img.png](../img/img4.png)
![img.png](../img/img3.png)

```java
// ìƒì‚°ì-ì†Œë¹„ì íŒ¨í„´ì—ì„œì˜ ë¬¸ì œ
public class ProducerConsumer {
    private Queue<Integer> queue = new LinkedList<>();
    private final int MAX_SIZE = 2;
    
    // ì˜ëª»ëœ êµ¬í˜„ - ë¬´í•œ ëŒ€ê¸° ë°œìƒ ê°€ëŠ¥
    public synchronized void put(int value) {
        while (queue.size() == MAX_SIZE) {
            // ì—¬ê¸°ì„œ ë¬´í•œ ëŒ€ê¸° ë°œìƒ!
            // ë½ì„ ë†“ì§€ ì•Šì€ ì±„ ëŒ€ê¸°í•˜ë¯€ë¡œ ì†Œë¹„ìê°€ ë½ì„ ì–»ì„ ìˆ˜ ì—†ìŒ
        }
        queue.offer(value);
        System.out.println("ìƒì‚°: " + value);
    }
    
    public synchronized int take() {
        while (queue.isEmpty()) {
            // ì—¬ê¸°ì„œë„ ë¬´í•œ ëŒ€ê¸° ë°œìƒ!
            // ë½ì„ ë†“ì§€ ì•Šì€ ì±„ ëŒ€ê¸°í•˜ë¯€ë¡œ ìƒì‚°ìê°€ ë½ì„ ì–»ì„ ìˆ˜ ì—†ìŒ
        }
        int value = queue.poll();
        System.out.println("ì†Œë¹„: " + value);
        return value;
    }
}
```

### ì™œ ë¬´í•œ ëŒ€ê¸°ì— ë¹ ì§€ëŠ”ê°€?
1. **ë½ ë³´ìœ  ìƒíƒœë¡œ ëŒ€ê¸°**: synchronized ë¸”ë¡ ë‚´ì—ì„œ while ë£¨í”„ë¡œ ì¡°ê±´ì„ í™•ì¸í•˜ë©° ëŒ€ê¸°
2. **ë½ í•´ì œ ì—†ìŒ**: ì¡°ê±´ì´ ë§Œì¡±ë˜ì§€ ì•Šì•„ë„ ë½ì„ í•´ì œí•˜ì§€ ì•ŠìŒ
3. **ë°ë“œë½ ìƒí™©**: ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¬ ìˆ˜ ì—†ì–´ ì˜ì›íˆ ëŒ€ê¸°

### ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ
```
1. íê°€ ê°€ë“ì°¸ (í¬ê¸°: 2/2)
2. Producer ìŠ¤ë ˆë“œê°€ put() í˜¸ì¶œ â†’ ë½ íšë“
3. while(queue.size() == MAX_SIZE) ì¡°ê±´ í™•ì¸ â†’ true
4. ë¬´í•œ ë£¨í”„ ì‹œì‘ (ë½ì„ ìœ ì§€í•œ ì±„)
5. Consumer ìŠ¤ë ˆë“œê°€ take() í˜¸ì¶œ â†’ ë½ ëŒ€ê¸°
6. ProducerëŠ” ë½ì„ ë†“ì§€ ì•Šì•„ Consumerê°€ íë¥¼ ë¹„ìš¸ ìˆ˜ ì—†ìŒ
7. âŒ ë°ë“œë½ ë°œìƒ
```

## Wait-Notify ë©”ì»¤ë‹ˆì¦˜ í•´ê²°ì±…

### 1. Object.wait() - ë½ í•´ì œì™€ ëŒ€ê¸°
```java
public synchronized void put(int value) throws InterruptedException {
    while (queue.size() == MAX_SIZE) {
        wait(); // âœ… ë½ì„ í•´ì œí•˜ê³  ëŒ€ê¸°
    }
    queue.offer(value);
    notifyAll(); // ëŒ€ê¸° ì¤‘ì¸ ì†Œë¹„ìë“¤ ê¹¨ìš°ê¸°
}
```

#### wait() ë©”ì„œë“œì˜ ë™ì‘ ê³¼ì •
1. **ì „ì œì¡°ê±´**: í˜„ì¬ ìŠ¤ë ˆë“œê°€ í•´ë‹¹ ê°ì²´ì˜ ë½(ëª¨ë‹ˆí„°ë½)ì„ ë³´ìœ í•´ì•¼ í•¨
2. **ë½ í•´ì œ**: í˜„ì¬ ìŠ¤ë ˆë“œê°€ ê°€ì§„ ë½ì„ ì¦‰ì‹œ ë°˜ë‚©
3. **ëŒ€ê¸° ìƒíƒœ ì „í™˜**: ìŠ¤ë ˆë“œë¥¼ WAITING ìƒíƒœë¡œ ì „í™˜
4. **ëŒ€ê¸° ì§‘í•© ì§„ì…**: í•´ë‹¹ ê°ì²´ì˜ ëŒ€ê¸° ì§‘í•©(wait set)ì— ìŠ¤ë ˆë“œ ì¶”ê°€
5. **ì•Œë¦¼ ëŒ€ê¸°**: notify() ë˜ëŠ” notifyAll() í˜¸ì¶œê¹Œì§€ ëŒ€ê¸°
6. **ë½ ì¬íšë“**: ê¹¨ì–´ë‚˜ë©´ ë½ì„ ë‹¤ì‹œ íšë“í•œ í›„ wait() ì´í›„ ì½”ë“œ ì‹¤í–‰

#### wait() ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­
- **ë°˜ë“œì‹œ synchronized ë¸”ë¡ ë‚´ì—ì„œ í˜¸ì¶œ**
- **while ë£¨í”„ì™€ í•¨ê»˜ ì‚¬ìš©** (spurious wakeup ë°©ì§€)
- **InterruptedException ì²˜ë¦¬ í•„ìš”**

### 2. notify() vs notifyAll() - ëŒ€ê¸° ìŠ¤ë ˆë“œ ê¹¨ìš°ê¸°
![img.png](../img/img5.png)
![img.png](../img/img6.png)
#### notify() - ë‹¨ì¼ ìŠ¤ë ˆë“œ ê¹¨ìš°ê¸°
```java
publìš°ic synchronized int take() throws InterruptedException {
    while (queue.isEmpty()) {
        wait();
    }
    int value = queue.poll();
    notify(); // ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ í•˜ë‚˜ë§Œ ê¹¨ì›€
    return value;
}
```

#### notifyAll() - ëª¨ë“  ëŒ€ê¸° ìŠ¤ë ˆë“œ ê¹¨ìš°ê¸°
```java
public synchronized int take() throws InterruptedException {
    while (queue.isEmpty()) {
        wait();
    }
    int value = queue.poll();
    notifyAll(); // ëŒ€ê¸° ì¤‘ì¸ ëª¨ë“  ìŠ¤ë ˆë“œ ê¹¨ì›€ (ê¶Œì¥)
    return value;
}
```

## notify() ì‹¤í–‰ ì‹œ WAITING -> BLOCKED ìƒíƒœ ë³€ê²½í•˜ëŠ” ì´ìœ 

### ì™œ WAITINGì—ì„œ ë°”ë¡œ RUNNABLEë¡œ ê°€ì§€ ì•Šì„ê¹Œ?

notify() í˜¸ì¶œ ì‹œ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œê°€ **WAITING â†’ RUNNABLE**ë¡œ ë°”ë¡œ ê°€ì§€ ì•Šê³  **WAITING â†’ BLOCKED**ë¥¼ ê±°ì¹˜ëŠ” ì´ìœ :

#### ìŠ¤ë ˆë“œ ìƒíƒœ ì „í™˜ ì‹œê°í™”

```
ğŸ“Š WAITING â†’ BLOCKED â†’ RUNNABLE ê³¼ì •

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ìŠ¤ë ˆë“œ ìƒíƒœ ë³€í™” ë‹¤ì´ì–´ê·¸ë¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ThreadA (ë½ ë³´ìœ )    ThreadB (wait ìƒíƒœ)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ RUNNABLE   â”‚      â”‚  WAITING   â”‚
  â”‚    ğŸ”’      â”‚      â”‚     ğŸ’¤     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚
        â”‚                    â”‚
   notify() í˜¸ì¶œ               â”‚
        â”‚                    â”‚
        â–¼                    â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ RUNNABLE   â”‚      â”‚  BLOCKED   â”‚  â† ì—¬ê¸°ê°€ í•µì‹¬!
  â”‚    ğŸ”’      â”‚      â”‚   ğŸš«ğŸ”’     â”‚  (ë½ ëŒ€ê¸° ì¤‘)
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚
        â”‚                    â”‚
  synchronized ë¸”ë¡ ì¢…ë£Œ       â”‚
        â”‚                    â”‚
        â–¼                    â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  WAITING   â”‚      â”‚ RUNNABLE   â”‚
  â”‚            â”‚      â”‚    ğŸ”’      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì‹œê°„ìˆœ ìƒíƒœ ë³€í™” ASCII í”Œë¡œìš°

```
ğŸ• T=0: ì´ˆê¸° ìƒíƒœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ì‹œê°„      â”‚      ThreadA        â”‚      ThreadB        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ T=0          â”‚ ğŸ”’ RUNNABLE        â”‚ ğŸ’¤ WAITING          â”‚
â”‚              â”‚ (ë½ ë³´ìœ  ì¤‘)        â”‚ (wait() ìƒíƒœ)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ•‘ T=1: notify() í˜¸ì¶œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T=1          â”‚ ğŸ”’ RUNNABLE        â”‚ ğŸš« BLOCKED          â”‚
â”‚              â”‚ notify() í˜¸ì¶œ!      â”‚ ë½ ëŒ€ê¸° ì¤‘!         â”‚
â”‚              â”‚ í•˜ì§€ë§Œ ì—¬ì „íˆ ë½ ë³´ìœ  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ•’ T=2: ì¶”ê°€ ì‘ì—… ìˆ˜í–‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T=2          â”‚ ğŸ”’ RUNNABLE        â”‚ ğŸš« BLOCKED          â”‚
â”‚              â”‚ doMoreWork() ì‹¤í–‰   â”‚ ì—¬ì „íˆ ë½ ëŒ€ê¸°...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ•“ T=3: ë½ í•´ì œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T=3          â”‚    WAITING          â”‚ ğŸ”’ RUNNABLE        â”‚
â”‚              â”‚ ë½ í•´ì œ!            â”‚ ë½ íšë“ ì„±ê³µ!       â”‚
â”‚              â”‚                     â”‚ wait() ì´í›„ ì‹¤í–‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë§Œì•½ WAITING â†’ RUNNABLE ì§ì ‘ ì „í™˜ì´ë¼ë©´?

```
âŒ ì˜ëª»ëœ ì‹œë‚˜ë¦¬ì˜¤ (ì§ì ‘ ì „í™˜)

 notify() í˜¸ì¶œ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ì¦‰ì‹œ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WAITING   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  RUNNABLE   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
                            ë½ íšë“ ì‹œë„ ì‹¤íŒ¨
                                   â†“
                          ë‹¤ì‹œ ëŒ€ê¸° ìƒíƒœë¡œ...
                                   â†“
                            ğŸ”„ ë¹„íš¨ìœ¨ì  ìˆœí™˜!
```

```
âœ… ì˜¬ë°”ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ (BLOCKED ê²½ìœ )

 notify() í˜¸ì¶œ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   ì¼ì‹œì    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   ë½ í•´ì œì‹œ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WAITING   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   BLOCKED   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  RUNNABLE   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ëŒ€ê¸°     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ì¦‰ì‹œ ì „í™˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           (ë½ ëŒ€ê¸° ì¤‘)                   (ì‹¤í–‰ ì¤€ë¹„)
```

#### BLOCKED ìƒíƒœì˜ ì¤‘ìš”ì„±

```
ğŸ­ ìŠ¤ë ˆë“œ ê³µì¥ ë¹„ìœ 

           ëŒ€ê¸°ì‹¤ (WAITING)          ì ‘ìˆ˜ì‹¤ (BLOCKED)          ì‘ì—…ì‹¤ (RUNNABLE)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ğŸ˜´ Thread1   â”‚       â”‚  ğŸš« Thread2    â”‚       â”‚  ğŸ”§ Thread3    â”‚
         â”‚   ğŸ˜´ Thread2   â”‚  â”€â”€â”€â†’ â”‚     (ë½ ëŒ€ê¸°)   â”‚  â”€â”€â”€â†’ â”‚     (ì‘ì—… ì¤‘)   â”‚
         â”‚   ğŸ˜´ Thread3   â”‚       â”‚                 â”‚       â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘                            â†‘                          â†‘
         wait() í˜¸ì¶œ                  notify() í˜¸ì¶œ               ë½ íšë“ ì„±ê³µ
```

#### ë½ ì†Œìœ ê¶Œ ë¬¸ì œ ì‹œê°í™”

```java
public synchronized void methodA() {
    // â”Œâ”€ ì´ ì§€ì ì—ì„œ ThreadAê°€ ë½ ë³´ìœ  ğŸ”’
    // â”‚
    someCondition = true;      // â† ThreadA ê³„ì† ì‹¤í–‰
    notify();                  // â† ThreadBë¥¼ ê¹¨ìš°ì§€ë§Œ...
    //                         //   ThreadAê°€ ì—¬ì „íˆ ë½ ë³´ìœ !
    doSomeMoreWork();          // â† ì¶”ê°€ ì‘ì—… (ì‹œê°„ ì†Œìš”)
    expensiveOperation();      // â† ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…
    // â”‚
    // â””â”€ ì—¬ê¸°ì„œì•¼ ë½ í•´ì œ ğŸ”“
}

/* 
   ThreadB ìƒíƒœ:
   notify() â†’ BLOCKED (ë½ì„ ê¸°ë‹¤ë¦¼)
            â³â³â³ ëŒ€ê¸°...
   ë½ í•´ì œ â†’ RUNNABLE (ë“œë””ì–´ ì‹¤í–‰!)
*/
```

#### ìƒíƒœ ì „í™˜ì˜ 3ë‹¨ê³„

```
ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸: ì™œ 3ë‹¨ê³„ì¸ê°€?

1ë‹¨ê³„: WAITING (ì¡°ê±´ ëŒ€ê¸°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "ì¡°ê±´ì´ ë§ì§€ ì•Šì•„ì„œ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘"      â”‚
â”‚ ğŸ’­ "íê°€ ë¹„ì–´ìˆë„¤... ëŒ€ê¸°í•˜ì"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ notify()
                 
2ë‹¨ê³„: BLOCKED (ë½ ëŒ€ê¸°)  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "ì¡°ê±´ì€ ë§ì„ ìˆ˜ ìˆì§€ë§Œ ë½ì´ ì—†ì–´!"    â”‚
â”‚ ğŸš« "ëˆ„êµ°ê°€ ë½ì„ ì“°ê³  ìˆë„¤..."         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ ë½ í•´ì œ
                 
3ë‹¨ê³„: RUNNABLE (ì‹¤í–‰ ì¤€ë¹„)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "ì¡°ê±´ë„ ë§ê³  ë½ë„ ìˆë‹¤! ì‹¤í–‰í•˜ì!"    â”‚
â”‚ ğŸš€ "ë“œë””ì–´ wait() ì´í›„ ì½”ë“œ ì‹¤í–‰!"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

notify()ë¡œ ê¹¨ì–´ë‚œ ìŠ¤ë ˆë“œëŠ” ë°˜ë“œì‹œ **ë½ì„ ì¬íšë“í•œ í›„ì—ì•¼** ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë©ë‹ˆë‹¤. 

## notify í•œê³„ ë° notifyAll() ì‚¬ìš©

### notify() í•œê³„
![img.png](../img/img7.png)
- notify()ëŠ” ëŒ€ê¸° ì§‘í•©ì—ì„œ ì„ì˜ì˜ ìŠ¤ë ˆë“œ í•˜ë‚˜ë§Œ ê¹¨ìš´ë‹¤ (WAITING â†’ BLOCKED)
- ì˜ëª»ëœ ìŠ¤ë ˆë“œê°€ ê¹¨ì–´ë‚  ìˆ˜ ìˆì–´ ë¹„íš¨ìœ¨ì ì¸ ìƒí™© ë°œìƒ

#### ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤: ì†Œë¹„ìë§Œ ëŒ€ê¸° ì¤‘ì¸ ìƒí™©
ëŒ€ê¸° ì§‘í•©ì— c1, c2, c3 ì†Œë¹„ì ìŠ¤ë ˆë“œë“¤ì´ ëŒ€ê¸° ì¤‘ì´ê³  íê°€ ë¹„ì–´ìˆë‹¤ê³  ê°€ì •:

```java
// í: [] (ë¹„ì–´ìˆìŒ), ëŒ€ê¸°ì§‘í•©: [c1, c2, c3]
c1 -> ë°ì´í„° ì†Œë¹„ ì™„ë£Œ -> notify() í˜¸ì¶œ -> c2 ìŠ¤ë ˆë“œë¥¼ ê¹¨ì›€
c2 -> BLOCKED ìƒíƒœê°€ ë¨ -> c1ì´ ë½ ë°˜ë‚© -> c2ê°€ ë½ íšë“
c2 -> í í™•ì¸ -> ì—¬ì „íˆ ë¹„ì–´ìˆìŒ -> wait() ë‹¤ì‹œ í˜¸ì¶œ -> ëŒ€ê¸°ì§‘í•© ë³µê·€

// ê²°ê³¼: c2ëŠ” ë¶ˆí•„ìš”í•˜ê²Œ ê¹¨ì–´ë‚¬ë‹¤ê°€ ë‹¤ì‹œ ëŒ€ê¸° ìƒíƒœë¡œ
//      ì‹¤ì œë¡œëŠ” ìƒì‚°ìë¥¼ ê¹¨ì›Œì•¼ í•˜ëŠ”ë° ê°™ì€ ì¢…ë¥˜ì˜ ì†Œë¹„ìë§Œ ê¹¨ì›€
```

#### ë” ì‹¬ê°í•œ ë¬¸ì œ: ìƒì‚°ì-ì†Œë¹„ì í˜¼ì¬ ìƒí™©
```java
// í: [A, B] (ê°€ë“ì°¸)
// ëŒ€ê¸°ì§‘í•©: [producer1, consumer1, producer2]

consumer1 -> ë°ì´í„° A ì†Œë¹„ -> notify() í˜¸ì¶œ -> producer2 ê¹¨ì›€ (ìš´ì¢‹ìŒ)
// ë˜ëŠ”
consumer1 -> ë°ì´í„° A ì†Œë¹„ -> notify() í˜¸ì¶œ -> producer1 ê¹¨ì›€ (ë¬¸ì œì—†ìŒ)  
// í•˜ì§€ë§Œ
consumer1 -> ë°ì´í„° A ì†Œë¹„ -> notify() í˜¸ì¶œ -> consumer1 ê¹¨ì›€ (ë¹„íš¨ìœ¨!)
```

### notifyAll() 
![img.png](../img/img8.png)
![img_1.png](../img/img9.png)

notify()ì˜ í•œê³„ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **notifyAll()** ì‚¬ìš©ì„ ê¶Œì¥:

#### ìŠ¤ë ˆë“œ ê¸°ì•„(Starvation) ë¬¸ì œ
```java
// í: [] (ë¹„ì–´ìˆìŒ)
// ëŒ€ê¸°ì§‘í•©: [c1, c2, c3, c4, c5, p1] (ì†Œë¹„ì 5ê°œ, ìƒì‚°ì 1ê°œ)

c1 ë°ì´í„° ì†Œë¹„ ì™„ë£Œ -> notify() í˜¸ì¶œ -> c2 ê¹¨ì›€ (ìš´ë‚˜ì¨)
c2 -> í ë¹„ì–´ìˆìŒ -> ë‹¤ì‹œ wait() -> ì˜ë¯¸ì—†ëŠ” ì‘ì—…

c1 ë°ì´í„° ì†Œë¹„ ì™„ë£Œ -> notify() í˜¸ì¶œ -> c3 ê¹¨ì›€ (ë˜ ìš´ë‚˜ì¨)  
c3 -> í ë¹„ì–´ìˆìŒ -> ë‹¤ì‹œ wait() -> ì˜ë¯¸ì—†ëŠ” ì‘ì—…

// p1 ìƒì‚°ìëŠ” ê³„ì† ê¹¨ì–´ë‚˜ì§€ ëª»í•´ ê¸°ì•„ ìƒíƒœ ë°œìƒ!
```

notify()ëŠ” ìŠ¤ë ˆë“œ ì„ íƒì´ ë¬´ì‘ìœ„ì´ë¯€ë¡œ:
- **ì˜ëª»ëœ íƒ€ì…ì˜ ìŠ¤ë ˆë“œ**ê°€ ê³„ì† ê¹¨ì–´ë‚  ìˆ˜ ìˆìŒ
- **í•„ìš”í•œ ìŠ¤ë ˆë“œ**(ìƒì‚°ì)ê°€ ê¸°ì•„ ìƒíƒœì— ë¹ ì§ˆ ìˆ˜ ìˆìŒ
- **ë¬´ì˜ë¯¸í•œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­** ë°œìƒ

#### notifyAll()ë¡œ í•´ê²°
```java
public synchronized T take() throws InterruptedException {
    while (queue.isEmpty()) {
        wait();
    }
    T item = queue.poll();
    notifyAll(); // ëª¨ë“  ëŒ€ê¸° ìŠ¤ë ˆë“œë¥¼ ê¹¨ì›Œì„œ ì¡°ê±´ ì¬í™•ì¸í•˜ê²Œ í•¨
    return item;
}

public synchronized void put(T item) throws InterruptedException {
    while (queue.size() == capacity) {
        wait();
    }
    queue.offer(item);
    notifyAll(); // ëª¨ë“  ëŒ€ê¸° ìŠ¤ë ˆë“œë¥¼ ê¹¨ì›€
}
```

#### notifyAll() ë™ì‘ ê³¼ì •
```java
// í: [] (ë¹„ì–´ìˆìŒ), ëŒ€ê¸°ì§‘í•©: [c1, c2, c3, p1]

p1 -> ë°ì´í„° ìƒì‚° -> notifyAll() í˜¸ì¶œ
-> ëª¨ë“  ëŒ€ê¸° ìŠ¤ë ˆë“œ ê¹¨ì–´ë‚¨: c1, c2, c3 ëª¨ë‘ BLOCKED ìƒíƒœë¡œ ì „í™˜
-> p1ì´ ë½ ë°˜ë‚©
-> c1ì´ ë½ íšë“ -> ì¡°ê±´ í™•ì¸ -> ë°ì´í„° ìˆìŒ -> ì†Œë¹„ í›„ ê³„ì† ì‹¤í–‰
-> c2ê°€ ë½ íšë“ -> ì¡°ê±´ í™•ì¸ -> ë°ì´í„° ì—†ìŒ -> wait() ë³µê·€
-> c3ê°€ ë½ íšë“ -> ì¡°ê±´ í™•ì¸ -> ë°ì´í„° ì—†ìŒ -> wait() ë³µê·€
```

#### notifyAll()ì˜ ì¥ì ê³¼ ë‹¨ì 

**ì¥ì :**
- **ì•ˆì „ì„±**: ëª¨ë“  ëŒ€ê¸° ìŠ¤ë ˆë“œê°€ ì¡°ê±´ì„ ë‹¤ì‹œ í™•ì¸í•  ê¸°íšŒë¥¼ ì–»ìŒ
- **ì •í™•ì„±**: ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìŠ¤ë ˆë“œê°€ í™•ì‹¤íˆ ê¹¨ì–´ë‚¨  
- **ê¸°ì•„ ë°©ì§€**: íŠ¹ì • ìŠ¤ë ˆë“œê°€ ì˜ì›íˆ ëŒ€ê¸°í•˜ëŠ” ìƒí™© ë°©ì§€
- **ë‹¨ìˆœì„±**: ë³µì¡í•œ ìŠ¤ë ˆë“œ ì„ íƒ ë¡œì§ ë¶ˆí•„ìš”

**ë‹¨ì :**
- **ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ**: ë¶ˆí•„ìš”í•œ ìŠ¤ë ˆë“œë“¤ë„ í•¨ê»˜ ê¹¨ì–´ë‚¨
- **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë¹„ìš©**: ë” ë§ì€ ìŠ¤ë ˆë“œ ì „í™˜ ë°œìƒ

#### ê¶Œì¥ì‚¬í•­
ì‹¤ë¬´ì—ì„œëŠ” **ì •í™•ì„± > ì„±ëŠ¥**ì´ë¯€ë¡œ **notifyAll() ì‚¬ìš©ì„ ê°•ë ¥ ê¶Œì¥**:
- notify()ëŠ” ë§¤ìš° ì œí•œì ì¸ ìƒí™©ì—ì„œë§Œ ì•ˆì „
- ë³µì¡í•œ ì¡°ê±´ì´ë‚˜ ì—¬ëŸ¬ íƒ€ì…ì˜ ìŠ¤ë ˆë“œê°€ ìˆì„ ë•ŒëŠ” ë°˜ë“œì‹œ notifyAll() ì‚¬ìš©




## ì™„ì „í•œ êµ¬í˜„ ì˜ˆì œ

### ìƒì‚°ì-ì†Œë¹„ì íŒ¨í„´ ì™„ì„±ë³¸
```java
public class BoundedQueue<T> {
    private final Queue<T> queue = new LinkedList<>();
    private final int capacity;
    
    public BoundedQueue(int capacity) {
        this.capacity = capacity;
    }
    
    // ìƒì‚°ì ë©”ì„œë“œ
    public synchronized void put(T item) throws InterruptedException {
        while (queue.size() == capacity) {
            System.out.println(Thread.currentThread().getName() + " ëŒ€ê¸°ì¤‘ (í ê°€ë“ì°¸)");
            wait(); // ë½ í•´ì œí•˜ê³  ëŒ€ê¸°
        }
        queue.offer(item);
        System.out.println(Thread.currentThread().getName() + " ìƒì‚°: " + item);
        notifyAll(); // ëŒ€ê¸°ì¤‘ì¸ ì†Œë¹„ìë“¤ ê¹¨ìš°ê¸°
    }
    
    // ì†Œë¹„ì ë©”ì„œë“œ
    public synchronized T take() throws InterruptedException {
        while (queue.isEmpty()) {
            System.out.println(Thread.currentThread().getName() + " ëŒ€ê¸°ì¤‘ (í ë¹„ì–´ìˆìŒ)");
            wait(); // ë½ í•´ì œí•˜ê³  ëŒ€ê¸°
        }
        T item = queue.poll();
        System.out.println(Thread.currentThread().getName() + " ì†Œë¹„: " + item);
        notifyAll(); // ëŒ€ê¸°ì¤‘ì¸ ìƒì‚°ìë“¤ ê¹¨ìš°ê¸°
        return item;
    }
    
    public synchronized int size() {
        return queue.size();
    }
}
```

### ì‹¤í–‰ íë¦„ ì‹œê°í™”

#### í•´ê²° ìƒí™© (wait-notify ì‚¬ìš©)
```
1. âœ… í•´ê²° ìƒí™©
   Queue: [A, B] (ê°€ë“ì°¸)
   Producer ìŠ¤ë ˆë“œ â†’ put() í˜¸ì¶œ â†’ ë½ íšë“ â†’ while(full) â†’ wait() 
   â†’ ë½ í•´ì œ â†’ ëŒ€ê¸°ì§‘í•©(wait set) ì§„ì…
   
   Consumer ìŠ¤ë ˆë“œ â†’ take() í˜¸ì¶œ â†’ ë½ íšë“ â†’ ì•„ì´í…œ ì†Œë¹„ â†’ notifyAll()
   â†’ Producer ê¹¨ìš°ê¸° â†’ ë½ í•´ì œ
   
   Producer ìŠ¤ë ˆë“œ â†’ ê¹¨ì–´ë‚¨ â†’ ë½ ì¬íšë“ â†’ while ì¡°ê±´ ì¬í™•ì¸ â†’ ì•„ì´í…œ ìƒì‚°
```

## í•µì‹¬ ê°œë… ì •ë¦¬

### 1. ëª¨ë‹ˆí„°ë½(Monitor Lock)ê³¼ ëŒ€ê¸° ì§‘í•©(Wait Set)
- **ëª¨ë“  ìë°” ê°ì²´ëŠ” ë‚´ì¥ ë½(intrinsic lock)ê³¼ ëŒ€ê¸° ì§‘í•©ì„ ê°€ì§**
- **ëª¨ë‹ˆí„°ë½**: synchronized ë¸”ë¡/ë©”ì„œë“œ ì§„ì… ì‹œ íšë“í•˜ëŠ” ë½
- **ëŒ€ê¸° ì§‘í•©**: wait() í˜¸ì¶œ ì‹œ ìŠ¤ë ˆë“œê°€ ëŒ€ê¸°í•˜ëŠ” ì§‘í•©
- ì„ê³„ì˜ì—­ ì•ˆì—ì„œ wait()ì„ í˜¸ì¶œí•˜ë©´ ëŒ€ê¸° ìƒíƒœì˜ ìŠ¤ë ˆë“œëŠ” ëŒ€ê¸°ì§‘í•©(wait set)ì— ë“¤ì–´ê°„ë‹¤.
- ëª¨ë“  ê°ì²´ëŠ” ë½(ëª¨ë‹ˆí„°ë½) + ëŒ€ê¸° ì§‘í•©ì„ ê°€ì§€ê³  ìˆë‹¤. ë‘˜ì€ í•œìŒìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

### 2. Wait-Notify ìƒëª…ì£¼ê¸°
```
1. synchronized ì§„ì… â†’ ë½ íšë“
2. ì¡°ê±´ ë¶ˆë§Œì¡± â†’ wait() í˜¸ì¶œ
3. ë½ í•´ì œ â†’ WAITING ìƒíƒœ â†’ ëŒ€ê¸°ì§‘í•© ì§„ì…
4. ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ notify/notifyAll í˜¸ì¶œ
5. ëŒ€ê¸°ì§‘í•©ì—ì„œ ê¹¨ì–´ë‚¨ â†’ BLOCKED ìƒíƒœ
6. ë½ ì¬íšë“ ì„±ê³µ â†’ RUNNABLE ìƒíƒœ
7. wait() ì´í›„ ì½”ë“œ ê³„ì† ì‹¤í–‰
```
